/*! OpenCrisp PathJS - v1.3.2 - 2017-07-02
* http://opencrisp.wca.at/docs/util.path.html
* Copyright (c) 2017 Fabian Schmid; Licensed [object Object] */

!function(t){function e(){}function i(){}function n(t,e,i){var n=L.call(t.itemEach,"Function")?t.itemEach:t.xEach,s=this;i=i||function(t){T.call(this,t,null,e)},n.callback.call(t,{self:this,reverse:this._revlist},function(){i.apply(s,arguments)})}function s(t,e){this.child&&this.child.exec({node:t},e),(L.call(t,"Array")||L.call(t,"Object"))&&(t.isField&&t.isField()||n.call(this,t,e,function(t){$["#"].call(this,t,e)}))}function c(t){return L.call(t,"Function")}function a(e,i,n,s){if(e){var c={};t.defineEvent(c),c.eventListener({self:this,action:"success",listen:n}),c.eventListener({self:this,action:"complete",listen:s}),e.exec({node:i},c)}}function l(t){var e,i,n,s,c=new o(this,t);for(s=n=c.add(1),z.lastIndex=this._index;!i&&(e=z.exec(this._path));)this._index=z.lastIndex,A+=1,void 0!==e[1]?(s._operator=e[1],s=s.value=c.add()):void 0!==e[2]?s._reverse=e[2].length:void 0!==e[3]?(n._next=e[3],s=n=c.add(1)):void 0!==e[4]?s.child=l.call(this,s):void 0!==e[5]?i=!0:void 0!==e[6]?s.child=new g(s,Number(e[6])):void 0!==e[7]?s.child=new g(s,"true"===e[7]):void 0!==e[8]?s.child=new g(s,e[8].replace(B,'"')):void 0!==e[9]?s.child=new g(s,e[9].replace(N,"'")):void 0!==e[10]?s.child=new g(s,new RegExp(e[10],e[11])):void 0!==e[12]?s.child=new g(s,this._values,e[12]):(this._index=e.index,s.parse()),z.lastIndex=this._index;return c}function r(){}function o(t,e){e||(this._reason=t),this._parent=e,this.condition=[]}function h(t,e,i){L.call(e,"Undefined")||"false"===e||!1===e||L.call(e,"Boolean")&&!e.valueOf()?u.call(this,t,!0,i):L.call(e.isBoolean,"Function")?e.isBoolean.tick||u.call(this,t,e.isBoolean()&&!e.valueOf()||!e,i):u.call(this,t,!e,i)}function u(t,e,i){t>0?(t-=1,h.apply(this,arguments)):i.call(this,e)}function f(t,e,i,n,s){if(!t)return n.call(this,e),void s.call(this);a.call(this,this.value,i,function(i){i instanceof RegExp&&(e=i.test(e),i=!0),e=R[t](e,i),n.call(this,e)},s)}function d(t){this._parent=t}function p(t){var e;W.lastIndex=this._index;var i=W.exec(this._path);if(!i)return new w(t);if(this._index=W.lastIndex,void 0!==i[1])e=new x(t).parse();else if(void 0!==i[3])(e=new _(t,i[3]).parse())._revlist=i[2];else if(void 0!==i[4])e=new w(t,i[4]).parse();else if(void 0!==i[6])(e=new m(t,i[6]).parse())._revlist=i[5];else if(void 0!==i[7])(e=new w(t,this.valueKey(i[7])).parse())._valkey=i[7];else if(void 0!==i[8])e=y.call(this,t);else{if(void 0===i[9])return void(this._index=i.index);e=new v(t).parse()}return e}function v(t){this._parent=t}function _(t,e){this._parent=t,J.test(e)?(e=J.exec(e),this._start=e[1],this._limit=e[2]):this._start=e}function x(t){this._parent=t}function w(t,e){Object.defineProperty(this,"_parent",{value:t}),this._attr=e}function m(t,e){this._parent=t,this._type=e}function y(t){var e,i;if(t instanceof k||(i=new k(t)),M.lastIndex=this._index,!(e=M.exec(this._path)))return i;if(this._index=M.lastIndex,void 0!==e[1])i=new k(t);else{if(void 0===e[2])return this._index=e.index,i;i=new k(t,e[2]),e[3]&&e[3].length>0&&(i._args=JSON.parse("["+e[3].replace(Q,"$1")+"]"))}return i.parse()}function k(t,e){this._parent=t,this._name=e}function g(t,e,i){this._parent=t,this._value=e,this._key=i}function T(t,e,n){var s;if(this.child)this.child.exec({node:t},n);else{var c=this.reason();if(!((c._count+=1)<=c._start)){try{n.eventTrigger({action:"success",args:[t]})}catch(t){if(!(t instanceof S))throw t;s=!0}if(s||-1!==c._limit&&c._count>=c._limit)throw n.eventPicker({cache:n,action:"complete",empty:!0}).End(),new i}}}function E(t,e){var n=l.call(t);try{n.exec({node:this},e)}catch(n){if(n instanceof i)return;if(void 0!==t._preset)return void e.eventTrigger({action:"success",args:t._preset});if(n instanceof j)return;throw n}}function F(t){this._path=t.path,this._values=t.values,this._preset=t.preset,this._limit=t.limit,this._start=t.start,this._async=t.async,this._count=0,this._index=0}function P(t){var e;return(t=t||"").xType("String")&&(t={path:t}),t.limit=1,t.async=!1,t.success=function(t){e=t},this.pathFind(t),L.call(e,"Undefined")&&(e=L.call(t.preset,"Function")?t.preset.call(this):t.preset),e}function O(e,i,n){var s;e=e||{},i=i||e.success,n=n||e.complete,s=e.self||this,e.limit=e.limit||-1,e.start=e.start||0,e.values=e.values||{},e.values.self=e.values.self||this,e.values.root=e.values.root||function(){return this.rootSelf()};var a=new F(e);a.level=0;var l={};return t.defineEvent(l),c(i)&&l.eventListener({action:"success",self:s,listen:i}),c(n)&&l.eventListener({action:"complete",self:s,listen:n}),I(this,E,[a,l],e.async),this}function b(t){return void 0!==this.pathNode({path:t})}var I=t.utilTick,L=t.type,S=t.ns("util.control.Break"),j=t.ns("util.control.End"),B=/\\"/g,N=/\\'/g,R={">":function(t,e){return t>e},"<":function(t,e){return t<e},">=":function(t,e){return t>=e},"<=":function(t,e){return t<=e},"==":function(t,e){return t===e},"!=":function(t,e){return t!==e}},$={"*":function(t,i){var s=this.specific();n.call(this,t,i,function(t){if(s)try{a.call(this,s,t,function(n){if(!n)throw new e;this.child.exec({node:t},i)},j)}catch(t){if(t instanceof e)throw new S}else this.child.exec({node:t},i)})},"+":function(t,e){this.child&&(this._specific=this.child.filter),T.call(this.child,t,null,e)},"#":function(t,e){var i=this.specific();i?a.call(this,i,t,function(i){i&&s.call(this,t,e)},j):s.call(this,t,e)}},z=new RegExp('\\s*(?:(\\!=|[<>=]{1,2})|(\\!+)|(&|\\|)|(\\[|\\()|(\\]|\\))\\.?|(-?\\d+(?:\\.\\d+)?)(?![\\.:~\\d])|(true|false)|"((?:[^"\\\\]*|\\\\"|\\\\)*)"|'+"'((?:[^'\\\\]*|\\\\'|\\\\)*)'|\\/((?:[^\\/\\\\]*|\\\\\\/|\\\\)+)\\/([igm]{1,3})?|\\$([\\w]+)\\s?(?![\\w\\.:])|.+)\\s*","g"),A=0;r.prototype={parent:function(t){return t?this._parent&&c(this._parent[t])&&this._parent[t]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){if(null!==this._specific)return this._specific||this.parent("specific")}};var U=o.prototype=new r;U.add=function(t){var e=new d(this);return t&&this.condition.push(e),e},U.exec=function(t,e){var i=e.eventPicker({cache:e,action:"complete",empty:!0});this.condition.xEach({self:this},function(n){i.Wait(),n.next("&")?a.call(this,n,t.node,function(t){if(!t)throw i.Talk(),new j},function(){i.Talk()}):n.next("|")?a.call(this,n,t.node,function(t){if(t)throw T.call(this,t,i,e),i.Talk(),new j},function(){i.Talk()}):(n.exec({node:t.node},e),i.Talk())},function(){i.Talk()})};var K=d.prototype=new r;K.parse=function(){return this.child=p.call(this.reason(),this),this},K.exec=function(t,e){var i=e.eventPicker({cache:e,action:"complete",empty:!0});if(!this.reverse()&&!this.operator())return T.call(this,t.node,i,e),void i.Talk();a.call(this,this.child,t.node,function(n){u.call(this,this.reverse(),n,function(n){i.Wait(),f.call(this,this.operator(),n,t.node,function(t){e.eventTrigger({action:"success",args:t})},function(){i.Talk()})})},function(){i.Talk()})},K.reverse=function(){return this._reverse||0},K.operator=function(){return this._operator||0},K.next=function(t){return t?this._next===t:this._next};var W=new RegExp("\\s*(?:(\\.)|(\\^)?(-?\\d*~\\d*|-\\d+)\\.?|(\\d+|[a-z_][a-z\\d\\-_]*)\\.?|(\\^)?([*#+])\\.?|\\$([a-z\\d_]+)\\.?|(:)|(\\[|\\()|.+)\\s*","g"),C=v.prototype=new r;C.parse=function(){return this.filter=l.call(this.reason(),this),this.child=p.call(this.reason(),this),this},C.exec=function(t,e){var i=t.node,n=e.eventPicker({cache:e,action:"complete",empty:!0}),s=this;a.call(this,this.filter,i,function(t){t&&T.call(s,i,n,e)},function(){n.Talk()})};var J=/^(-?\d+)?~(\d+)?$/,q=_.prototype=new r;q.parse=function(){return this.child=p.call(this.reason(),this),this},q.exec=function(t,i){var n,s=i.eventPicker({cache:i,action:"complete",empty:!0}),c={self:this,reverse:this._revlist};L.call(t.node.itemLimit,"Function")?(c.start=this._start,c.limit=this._limit,n=t.node.itemLimit):(c.start=this._start||0,c.limit=this._limit||10,n=t.node.xEach),n.callback.call(t.node,c,function(t){var n=this.specific();if(n)try{a.call(this,n,t,function(n){if(!n)throw new e;T.call(this,t,null,i)},function(){})}catch(t){if(t instanceof e)throw new S}else T.call(this,t,null,i)}),s.Talk()};var D=x.prototype=new r;D.parse=function(){return this.child=p.call(this.reason(),this),this},D.exec=function(t,e){T.call(this,t.node.__parent__,null,e)};var G=w.prototype=new r;G.parse=function(){return this.child=p.call(this.reason(),this),this},G.exec=function(t,e){var i=this,n=e.eventPicker({cache:e,action:"complete",empty:!0});if(!L.call(i.attr(),"Undefined")&&L.call(t.node.itemFetch,"Function"))return t.node.itemFetch({name:i.attr()},function(t){T.call(i,t,n,e)},function(){n.Talk()});L.call(t.node,"Object")&&-1!==Object.keys(t.node).indexOf(i.attr())||L.call(t.node,"Array")&&t.node[i.attr()]?T.call(i,t.node[i.attr()],n,e):i._valkey?t.node=i.child.exec({node:i.attr()},e):i.attr()||T.call(i,t.node,n,e),n.Talk()},G.attr=function(){return this._attr};var H=m.prototype=new r;H.parse=function(){return this.child=p.call(this.reason(),this),this},H.exec=function(t,e){$[this.type()].call(this,t.node,e)},H.type=function(){return this._type};var M=new RegExp("(?:(\\.)|(\\w+)(?:\\(((?:[^)\\\\]*|\\\\\\)|\\\\)+)\\))?\\.?)\\s*|.+","g"),Q=/\\([\(\)])/g,V=k.prototype=new r;V.parse=function(){return this.child=y.call(this.reason(),this),this},V.exec=function(e,i){var n,s,a=this,l=e.node[this.name()];if(c(l)){if(s=i.eventPicker({cache:i,action:"complete",empty:!0}),!l.tick)return e.node=l.apply(e.node,this.args()),T.call(this,e.node,s,i),void s.Talk();n=t.callSchema(l.schema||l.tick,this.args()),l.call(e.node,n,function(t){T.call(a,t,s,i)},function(){s.Talk()},s)}},V.name=function(){return this._name||"toString"},V.args=function(){return[].xAdd(this._args)},(g.prototype=new r).exec=function(t,e){var i=e.eventPicker({cache:e,action:"complete",empty:!0}),n=this._key?this._value[this._key]:this._value;T.call(this,n,i,e),i.Talk()},F.prototype={valueKey:function(t){var e=this._values[t];return L.call(e,"Function")?e.call(this):e},rootSelf:function(){for(var t=this._values.self;t.__parent__;)t=t.__parent__;return t}},t.ns("util.path").prototypes={pathNode:P,pathFind:O,pathExists:b},t.definePath=function(t){Object.defineProperties(t,{pathNode:{value:P},pathFind:{value:O},pathExists:{value:b}})}}(Crisp);